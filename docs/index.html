<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Card Snake Game - 技术文档</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+JP:wght@300;400;500&family=Noto+Sans+SC:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #ffffff;
            --bg-card: #f8f9fa;
            --bg-code: #f5f7f9;
            --border: #dee2e6;
            --border-light: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #495057;
            --text-muted: #6c757d;
            --accent: #1e3a8a;
            --accent-light: #3b82f6;
            --accent-bg: #eff6ff;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --radius: 8px;
            --sidebar-width: 280px;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Noto Sans SC', 'Inter', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.8;
            font-size: 15px;
        }
        
        .layout { display: flex; min-height: 100vh; }
        
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            padding: 2rem 0;
        }
        
        .logo {
            padding: 0 2rem 1.5rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }
        
        .logo p {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        
        .nav-section {
            margin-bottom: 1.5rem;
        }
        
        .nav-title {
            padding: 0 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        
        .nav-links {
            list-style: none;
        }
        
        .nav-links li a {
            display: block;
            padding: 0.5rem 2rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .nav-links li a:hover {
            background: var(--accent-bg);
            color: var(--accent);
            border-left-color: var(--accent-light);
        }
        
        .nav-links li a.active {
            background: var(--accent-bg);
            color: var(--accent);
            border-left-color: var(--accent);
            font-weight: 500;
        }
        
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 3rem 4rem;
            max-width: 1200px;
        }
        
        .header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        
        .header p {
            font-size: 1.125rem;
            color: var(--text-secondary);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--accent-bg);
            color: var(--accent);
            border: 1px solid var(--accent-light);
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-right: 0.5rem;
            margin-top: 1rem;
        }
        
        .section {
            margin-bottom: 3rem;
        }
        
        .section-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--accent);
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 0.5rem;
        }
        
        .subsection-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--text-primary);
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--accent);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            transition: all 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent-light);
        }
        
        .feature-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }
        
        .feature-desc {
            color: var(--text-secondary);
            font-size: 0.9375rem;
        }
        
        code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-code);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            color: var(--accent);
            border: 1px solid var(--border-light);
        }
        
        pre {
            background: var(--bg-code);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: var(--text-primary);
            border: none;
        }
        
        ul, ol {
            padding-left: 1.5rem;
            margin: 1rem 0;
        }
        
        li {
            margin: 0.5rem 0;
            color: var(--text-secondary);
        }
        
        a {
            color: var(--accent-light);
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        .info-box {
            background: var(--accent-bg);
            border-left: 4px solid var(--accent);
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }
        
        .info-box strong {
            color: var(--accent);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }
        
        th {
            background: var(--bg-code);
            font-weight: 600;
            color: var(--accent);
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
                padding: 2rem 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="logo">
                <h1>Poker Snake</h1>
                <p>技术文档</p>
            </div>
            
            <nav>
                <div class="nav-section">
                    <div class="nav-title">概览</div>
                    <ul class="nav-links">
                        <li><a href="#overview" class="active">游戏概述</a></li>
                        <li><a href="#features">核心特性</a></li>
                        <li><a href="#architecture">系统架构</a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">核心系统</div>
                    <ul class="nav-links">
                        <li><a href="#snake-system">贪吃蛇系统</a></li>
                        <li><a href="#poker-system">扑克牌系统</a></li>
                        <li><a href="#input-system">输入系统</a></li>
                        <li><a href="#vfx-system">特效系统</a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">技术细节</div>
                    <ul class="nav-links">
                        <li><a href="#algorithms">核心算法</a></li>
                        <li><a href="#optimization">性能优化</a></li>
                        <li><a href="#design-patterns">设计模式</a></li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-title">开发指南</div>
                    <ul class="nav-links">
                        <li><a href="#setup">项目设置</a></li>
                        <li><a href="#scripts">脚本文档</a></li>
                        <li><a href="#troubleshooting">问题排查</a></li>
                    </ul>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <header class="header">
                <h1>Poker Card Snake Game</h1>
                <p>扑克牌驱动的贪吃蛇游戏 - 技术文档</p>
                <div>
                    <span class="badge">Unity 2021.3+</span>
                    <span class="badge">C#</span>
                    <span class="badge">2D Game</span>
                </div>
            </header>
            
            <section id="overview" class="section">
                <h2 class="section-title">游戏概述</h2>
                
                <div class="card">
                    <p>Poker Card Snake Game 是一款创新的贪吃蛇变体游戏，融合了扑克牌抽取机制和经典贪吃蛇玩法。玩家通过洗牌抽取扑克牌组合来动态生成地图元素，同时控制贪吃蛇吃球得分，在20秒内挑战高分！</p>
                </div>
                
                <h3 class="subsection-title">核心玩法</h3>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-title">扑克牌系统</div>
                        <div class="feature-desc">洗牌抽取6张牌，自动识别斗地主牌型，生成对应的地图元素</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">贪吃蛇系统</div>
                        <div class="feature-desc">20×35大型网格，8方向移动，拖拽距离控制速度，四方向穿越</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">20秒挑战</div>
                        <div class="feature-desc">时间到游戏胜利，撞到障碍或自己即刻失败，考验反应和策略</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">特效系统</div>
                        <div class="feature-desc">粒子特效、弹性动画、蛇头拖尾，速度越快特效越炫</div>
                    </div>
                </div>
            </section>
            
            <section id="features" class="section">
                <h2 class="section-title">核心特性</h2>
                
                <div class="card">
                    <div class="card-title">1. 动态速度控制</div>
                    <p>拖拽距离越长，蛇移动越快（0.5x - 2.0x），松开恢复正常速度。</p>
                    <pre><code>// 线性插值计算速度倍数
float speedMultiplier = Mathf.Lerp(
    minSpeedMultiplier,  // 0.5x
    maxSpeedMultiplier,  // 2.0x
    dragDistance / maxDragDistance
);</code></pre>
                </div>
                
                <div class="card">
                    <div class="card-title">2. 2x2大型得分球</div>
                    <p>得分球大小为2x2，占据4个格子，碰撞面积增加4倍，蛇头碰到任意一格都算吃到。</p>
                    <ul>
                        <li>视觉大小：<code>cellSize * 2f * 0.9f</code></li>
                        <li>占用格子：4个（2x2区域）</li>
                        <li>碰撞判定：蛇头碰到4个格子中任意一个即可</li>
                    </ul>
                </div>
                
                <div class="card">
                    <div class="card-title">3. 扑克牌组合识别</div>
                    <p>支持斗地主全部牌型：单张、对子、三张、三带一、三带二、顺子、连对、飞机、四带二。</p>
                    <table>
                        <thead>
                            <tr>
                                <th>牌型</th>
                                <th>英文名</th>
                                <th>生成效果</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>对子/三张</td>
                                <td>PAIR/THREE</td>
                                <td>20%障碍物 或 80%得分球</td>
                            </tr>
                            <tr>
                                <td>三带一/三带二</td>
                                <td>THREE WITH ONE/PAIR</td>
                                <td>10个得分球</td>
                            </tr>
                            <tr>
                                <td>顺子/连对</td>
                                <td>STRAIGHT/DOUBLE STRAIGHT</td>
                                <td>20个得分球</td>
                            </tr>
                            <tr>
                                <td>飞机/四带二</td>
                                <td>PLANE/FOUR WITH TWO</td>
                                <td>40个得分球</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="card">
                    <div class="card-title">4. 粒子特效系统</div>
                    <p>使用 Layer Lab 粒子素材，包含5大类特效：</p>
                    <ul>
                        <li><strong>吃球特效</strong> - Particle_Stars_00（星星爆炸）</li>
                        <li><strong>洗牌特效</strong> - Particle_Card_00（卡牌飞舞）</li>
                        <li><strong>胜利特效</strong> - Particle_Firework_00（烟花庆祝）</li>
                        <li><strong>失败特效</strong> - Particle_Smoke_00（烟雾消散）</li>
                        <li><strong>蛇头拖尾</strong> - Particle_Trail_00（持续跟随，速度越快粒子越多）</li>
                    </ul>
                </div>
            </section>
            
            <section id="architecture" class="section">
                <h2 class="section-title">系统架构</h2>
                
                <div class="card">
                    <div class="card-title">项目结构</div>
                    <pre><code>U3D_Shuffle_Snake/
├── Assets/Scripts/
│   ├── GameManager.cs              # 游戏状态、计时器、分数
│   ├── GameScene/
│   │   ├── SnakeGridManager.cs    # 20×35网格、碰撞检测
│   │   ├── SnakeController.cs     # 蛇移动、增长、碰撞
│   │   ├── TouchInputManager.cs   # 拖拽输入、速度控制
│   │   ├── PokerManager.cs        # 扑克牌管理、洗牌
│   │   ├── PokerComboDetector.cs  # 牌型识别
│   │   ├── VFXManager.cs          # 特效管理、对象池
│   │   └── CellController.cs      # 格子控制器
│   └── UIScripts/
│       ├── GameResultPopup.cs     # 胜利/失败弹窗
│       ├── TimerDisplay.cs        # 倒计时显示
│       └── ScoreDisplay.cs        # 分数显示
└── Resources/Poke/                # 扑克牌资源</code></pre>
                </div>
                
                <h3 class="subsection-title">设计模式</h3>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-title">单例模式</div>
                        <div class="feature-desc">GameManager, VFXManager, SnakeController 等全局管理器使用单例模式，确保全局唯一访问。</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">组件化设计</div>
                        <div class="feature-desc">高内聚低耦合的脚本架构，每个脚本负责单一职责，便于维护和扩展。</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">对象池模式</div>
                        <div class="feature-desc">VFX特效使用对象池复用，减少实例化开销和GC压力。</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">事件驱动</div>
                        <div class="feature-desc">使用协程驱动游戏流程，清晰的事件链和时序控制。</div>
                    </div>
                </div>
            </section>
            
            <section id="algorithms" class="section">
                <h2 class="section-title">核心算法</h2>
                
                <div class="card">
                    <div class="card-title">1. 屏幕穿越算法</div>
                    <p>支持四方向边界穿越（左右、上下互通）：</p>
                    <pre><code>public Vector2Int WrapGridPosition(Vector2Int gridPos)
{
    int newX = (gridPos.x + gridWidth) % gridWidth;
    int newY = (gridPos.y + gridHeight) % gridHeight;
    return new Vector2Int(newX, newY);
}</code></pre>
                </div>
                
                <div class="card">
                    <div class="card-title">2. 2x2碰撞优化</div>
                    <p>得分球占据4个格子，蛇头碰到任意一格都算吃到：</p>
                    <pre><code>// 注册4个格子都被占用
for (int x = 0; x < 2; x++)
    for (int y = 0; y < 2; y++)
        RegisterCell(bottomLeft + new Vector2Int(x, y), 
                    CellType.ScoreBall, ball);

// 清除时找到所有指向同一对象的格子
foreach (var kvp in cellObjects)
{
    if (kvp.Value == ballObj)
        cellsToClear.Add(kvp.Key);
}</code></pre>
                </div>
                
                <div class="card">
                    <div class="card-title">3. HashSet碰撞检测</div>
                    <p>使用 HashSet 存储占用格子，O(1)复杂度查询：</p>
                    <pre><code>private HashSet<Vector2Int> occupiedCells;
private Dictionary<Vector2Int, CellType> cellTypes;
private Dictionary<Vector2Int, GameObject> cellObjects;

public bool IsCellOccupied(Vector2Int gridPos)
{
    return occupiedCells.Contains(gridPos);  // O(1)
}</code></pre>
                </div>
            </section>
            
            <section id="optimization" class="section">
                <h2 class="section-title">性能优化</h2>
                
                <ul>
                    <li><strong>HashSet 数据结构</strong> - O(1)复杂度的碰撞检测</li>
                    <li><strong>对象池系统</strong> - VFX特效复用，减少GC</li>
                    <li><strong>预制体缓存</strong> - 避免频繁资源加载</li>
                    <li><strong>平滑移动插值</strong> - AnimationCurve实现丝滑动画</li>
                    <li><strong>事件驱动架构</strong> - 协程+yield实现高效时序控制</li>
                </ul>
            </section>
            
            <section id="setup" class="section">
                <h2 class="section-title">项目设置</h2>
                
                <div class="info-box">
                    <strong>系统要求</strong><br>
                    Unity 2021.3 LTS 或更高版本<br>
                    TextMeshPro 包<br>
                    Layer Lab GUI Pro 素材包
                </div>
                
                <h3 class="subsection-title">快速开始</h3>
                
                <ol>
                    <li>克隆仓库：<code>git clone https://github.com/NewbieAudioKid/U3D_Shuffle_Snake.git</code></li>
                    <li>在 Unity 2021.3+ 中打开项目</li>
                    <li>打开 <code>Assets/Scenes/SplashScene.unity</code></li>
                    <li>点击 Play 按钮运行游戏</li>
                </ol>
                
                <h3 class="subsection-title">Unity Inspector 设置</h3>
                
                <table>
                    <thead>
                        <tr>
                            <th>组件</th>
                            <th>关键参数</th>
                            <th>推荐值</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>GameManager</td>
                            <td>Game Time</td>
                            <td>20秒</td>
                        </tr>
                        <tr>
                            <td>SnakeGridManager</td>
                            <td>Grid Width × Height</td>
                            <td>20 × 35</td>
                        </tr>
                        <tr>
                            <td>SnakeGridManager</td>
                            <td>Cell Size</td>
                            <td>0.4f</td>
                        </tr>
                        <tr>
                            <td>TouchInputManager</td>
                            <td>Min/Max Speed Multiplier</td>
                            <td>0.5x / 2.0x</td>
                        </tr>
                        <tr>
                            <td>VFXManager</td>
                            <td>Enable Snake Head VFX</td>
                            <td>是</td>
                        </tr>
                    </tbody>
                </table>
            </section>
            
            <section id="scripts" class="section">
                <h2 class="section-title">脚本文档</h2>
                
                <div class="card">
                    <div class="card-title">核心脚本列表</div>
                    <ul>
                        <li><code>GameManager.cs</code> - 游戏状态、计时器、分数管理</li>
                        <li><code>SnakeGridManager.cs</code> - 20×35网格系统、碰撞检测、地图生成</li>
                        <li><code>SnakeController.cs</code> - 蛇移动逻辑、增长、碰撞处理、平滑动画</li>
                        <li><code>TouchInputManager.cs</code> - 拖拽输入、动态速度控制、区域分离</li>
                        <li><code>PokerManager.cs</code> - 扑克牌管理、洗牌、显示、弹性动画</li>
                        <li><code>PokerComboDetector.cs</code> - 斗地主牌型识别算法</li>
                        <li><code>VFXManager.cs</code> - 特效管理、对象池、蛇头拖尾</li>
                    </ul>
                </div>
                
                <div class="info-box">
                    <strong>Google Style 注释规范</strong><br>
                    所有脚本都遵循 Google C# Style Guide，包含详细的类说明、方法注释、参数说明和返回值文档。
                </div>
            </section>
            
            <section id="troubleshooting" class="section">
                <h2 class="section-title">问题排查</h2>
                
                <div class="info-box">
                    <strong>特效不显示？</strong><br>
                    设置粒子预制体的 <code>Order in Layer = 999</code><br>
                    详见：<code>VFX_QuickFix.md</code>
                </div>
                
                <div class="info-box">
                    <strong>扑克牌显示白牌？</strong><br>
                    确保PNG导入设置为 <code>Sprite (2D and UI)</code><br>
                    详见：<code>Phase5_PokerCard_Visual_Fix.md</code>
                </div>
                
                <h3 class="subsection-title">更多文档</h3>
                <ul>
                    <li><code>Phase1-7_Setup_Guide.md</code> - 分阶段开发指南</li>
                    <li><code>NewFeatures_Setup_Guide.md</code> - 新功能设置</li>
                    <li><code>SnakeHeadVFX_Setup_Guide.md</code> - 蛇头拖尾特效</li>
                    <li><code>ScoreBall_2x2_Implementation.md</code> - 2x2得分球实现</li>
                    <li><code>VFX_Troubleshooting_Guide.md</code> - 特效问题完整排查</li>
                </ul>
            </section>
            
            <footer style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border); text-align: center; color: var(--text-muted);">
                <p>Built by NewbieAudioKid</p>
                <p>Poker Card Snake Game © 2026</p>
            </footer>
        </main>
    </div>
    
    <script>
        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    
                    // Update active link
                    document.querySelectorAll('.nav-links a').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
        });
        
        // Update active link on scroll
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section[id]');
            const scrollPos = window.scrollY + 100;
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                const sectionId = section.getAttribute('id');
                
                if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                    document.querySelectorAll('.nav-links a').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${sectionId}`) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
