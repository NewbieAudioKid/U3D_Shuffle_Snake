# 2x2 得分球 - 实现说明

## ✅ 已完成的修改

### 1. SnakeGridManager.cs 的改动

#### 新增方法：

**`CanPlace2x2ScoreBall(Vector2Int bottomLeft)`**
- 检查指定位置能否放置2x2得分球
- 验证边界（确保不超出网格）
- 验证2x2区域内所有格子都为空

**`Create2x2ScoreBall(Vector2Int bottomLeft)`**
- 创建一个2x2大小的得分球对象
- 计算2x2区域的中心位置作为对象位置
- 缩放为原来的2倍（`cellSize * 2f * 0.9f`）
- 在网格中注册4个格子都被占用

**`Clear2x2ScoreBall(Vector2Int hitPos)`**
- 当蛇吃到得分球时调用
- 找到并清除所有指向同一个GameObject的格子
- 确保4个格子都被正确清除
- 销毁GameObject

**`GenerateScoreBalls(int count)` - 重写**
- 改为生成2x2大小的得分球
- 每次随机选择一个空位作为左下角
- 验证2x2区域可用后再生成
- 限制最大尝试次数，避免死循环

### 2. SnakeController.cs 的改动

**`EatScoreBall(Vector2Int pos)` - 更新**
- 调用新的 `Clear2x2ScoreBall()` 方法
- 注释更新为"2x2大小"

---

## 🎮 工作原理

### 碰撞检测机制

```
2x2 得分球占据 4 个格子：

┌───┬───┐
│ A │ B │  A = (x, y+1)    B = (x+1, y+1)
├───┼───┤
│ C │ D │  C = (x, y)      D = (x+1, y)
└───┴───┘

蛇头碰到 A、B、C、D 任何一个格子都会触发吃球
```

### 生成逻辑

```
1. 随机选择一个空格子作为左下角 (C位置)
2. 检查右上角 (B位置) 是否超出边界
3. 检查 A、B、C、D 四个格子是否都为空
4. 如果满足条件，创建2x2得分球
5. 在网格中注册4个格子都指向同一个GameObject
```

### 清除逻辑

```
1. 蛇头碰到任意一个格子 (例如 A)
2. 获取该格子对应的GameObject
3. 遍历所有格子，找到所有指向该GameObject的格子
4. 清除所有相关格子的注册信息
5. 销毁GameObject
```

---

## 🔍 关键改进点

### 1. 避免重叠
- 生成前检查2x2区域是否都为空
- 注册4个格子占用，其他对象不会生成在这里

### 2. 边界检查
- 确保 `bottomLeft.x + 1 < gridWidth`
- 确保 `bottomLeft.y + 1 < gridHeight`
- 防止得分球超出网格

### 3. 碰撞容错
- 蛇头只要碰到2x2区域的任何一格就算吃到
- 清除时会找到并删除所有4个格子的引用
- 避免留下"幽灵"格子

### 4. 视觉大小
- GameObject 的 scale 设置为 `cellSize * 2f * 0.9f`
- 比实际占用区域稍小（0.9倍），视觉上更清晰

---

## 📊 参数说明

### 原来（1x1）
```
大小：cellSize * 0.8f
占用：1个格子
碰撞：蛇头必须精确碰到那1个格子
```

### 现在（2x2）
```
大小：cellSize * 2f * 0.9f
占用：4个格子
碰撞：蛇头碰到4个格子中任意一个即可
```

---

## 🐛 可能的问题和解决方案

### 问题 1：得分球生成数量少于请求数量

**原因**：网格空间不足，无法找到足够的2x2空位

**解决**：
- 这是正常的，代码会尽力生成
- 可以在 Console 中看到实际生成数量
- 如果需要更多，可以增加 `maxAttempts` 或清理网格

### 问题 2：得分球靠近边界时视觉超出

**原因**：得分球中心在边界内，但视觉大小让它看起来超出

**解决**：
- 代码已经确保右上角不超出 `gridWidth` 和 `gridHeight`
- 视觉大小设置为 0.9 倍，留有余地

### 问题 3：吃球后有残留

**原因**：清除逻辑没有正确删除所有4个格子

**解决**：
- 使用 `Clear2x2ScoreBall()` 方法
- 遍历所有格子，找到并清除所有相关引用
- 代码已经实现

---

## ✅ 测试清单

运行游戏后检查：

- [ ] 得分球大小明显比蛇头大（2x2 vs 1x1）
- [ ] 蛇头碰到得分球边缘也能吃到（不需要精确对准中心）
- [ ] 吃球后整个得分球消失（没有残留）
- [ ] 得分球不会超出网格边界
- [ ] 得分球之间不会重叠
- [ ] 得分球不会和障碍物重叠
- [ ] Console 显示 "清除2x2得分球，清除了 4 个格子"

---

## 🎨 视觉效果对比

### 之前（1x1）
```
蛇头: ●
得分球: •

很难吃到，需要精确对准
```

### 之后（2x2）
```
蛇头: ●
得分球: ◉ (4倍大)

容易吃到，碰到任何边缘都可以
```

---

## 📝 代码位置总结

### SnakeGridManager.cs
- **第 323-442 行**：新的2x2得分球生成和清除逻辑

### SnakeController.cs
- **第 310-335 行**：更新的吃球方法

---

完成修改后，得分球会大4倍，蛇会更容易吃到！🎮✨

